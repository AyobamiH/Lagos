import{r as n,u as me,k as fe,d as pe,g as U,e as xe,c as J,t as P,i as $e,o as Me,m as M,j as e,L as Ee,O as Te}from"./index-CQqwMk0w.js";import{c as De,l as ge,b as he,e as Re,d as Fe,M as qe,T as Be,a as Ge,L as ze}from"./TileLayer-Bir63tuw.js";import{p as Ue,a as Je}from"./validation-Bd_H_RqW.js";import{f as E}from"./format-CHNCD0FC.js";const Qe=De(function({data:i,...a},h){const A=new ge.GeoJSON(i,a);return he(A,Re(h,{overlayContainer:A}))},function(i,a,h){a.style!==h.style&&(a.style==null?i.resetStyle():i.setStyle(a.style))}),We=Fe(function(i,a){const h=new ge.Popup(i,a.overlayContainer);return he(h,a)},function(i,a,{position:h},A){n.useEffect(function(){const{instance:b}=i;function g(l){l.popup===b&&(b.update(),A(!0))}function S(l){l.popup===b&&A(!1)}return a.map.on({popupopen:g,popupclose:S}),a.overlayContainer==null?(h!=null&&b.setLatLng(h),b.openOn(a.map)):a.overlayContainer.bindPopup(b),function(){var v;a.map.off({popupopen:g,popupclose:S}),(v=a.overlayContainer)==null||v.unbindPopup(),a.map.removeLayer(b)}},[i,a,A,h])});function Ye(){const{token:o}=me(),{push:i}=fe(),[a,h]=n.useState(null),[A,p]=n.useState(null),[b,g]=n.useState(!1),[S,l]=n.useState(new Set),v=pe(),[Q,j]=n.useState(null);n.useEffect(()=>{if(!o)return;U()||xe(o);const d=U();if(!d)return;function y(m){a&&m.rideId===a&&p(m.status)}return d.on("ride_status",y),()=>{d.off("ride_status",y)}},[o,a]);const T=n.useCallback(async d=>{if(o){g(!0),j(null);try{const y=await J.driverAcceptRide(o,d);h(d),p(y.status),i({message:`${P("ride_accept_success")}: ${d}`,type:"success"})}catch(y){const m=y.friendlyMessage||y.error||P("ride_accept_failed");j(m),i({message:m,type:"error"})}g(!1)}},[o,i]),D=n.useCallback(async d=>{if(o){g(!0),j(null);try{await J.driverDeclineRide(o,d),i({message:`${P("ride_decline_success")}: ${d}`,type:"info"})}catch(y){const m=y.friendlyMessage||y.error||P("ride_decline_failed");j(m),i({message:m,type:"error"})}g(!1)}},[o,i]);function R(d){return a?`${a}:${d}`:d}const N=n.useCallback(async d=>{if(!o||!a)return;const y=R(d);if(!S.has(y)){l(m=>new Set(m).add(y));try{const m=await v.driverLifecycleOrQueue({rideId:a,op:d});m.mode==="immediate"&&!m.error?(d==="arrive"&&p("arrived_pickup"),d==="start"&&p("on_trip"),d==="complete"&&p("completed")):m.mode==="queued"?i({message:P(`lifecycle_${d}_queued`,`Lifecycle ${d} queued`),type:"info"}):m.error&&i({message:m.error.friendlyMessage||m.error.error||P(`lifecycle_${d}_failed`,`${d}_failed`),type:"error"})}finally{l(m=>{const I=new Set(m);return I.delete(y),I})}}},[o,a,v,S,i]),F=n.useCallback(()=>N("arrive"),[N]),C=n.useCallback(()=>N("start"),[N]),q=n.useCallback(()=>N("complete"),[N]);return{rideId:a,status:A,accepting:b,error:Q,accept:T,decline:D,arrive:F,start:C,complete:q}}function ue({ts:o}){const[i,a]=n.useState(()=>Date.now());n.useEffect(()=>{const g=setInterval(()=>a(Date.now()),1e3);return()=>clearInterval(g)},[]);const h=n.useMemo(()=>{const g=Date.parse(o);return Number.isNaN(g)?null:g},[o]);if(!h)return e.jsx("span",{children:"—"});const A=Math.max(0,Math.floor((h-i)/1e3)),p=Math.floor(A/60),b=A%60;return e.jsxs("span",{children:[p,":",b.toString().padStart(2,"0")]})}function st(){var de;const{token:o,profile:i}=me(),{push:a}=fe(),[h,A]=n.useState([]),[p,b]=n.useState(null),[g,S]=n.useState(null),l=Ye(),{lastSos:v,clearLastSos:Q}=$e(),[j,T]=n.useState({lat:"6.5244",lng:"3.3792"}),[D,R]=n.useState(!1),[N,F]=n.useState(!1),C=n.useRef(null),q=n.useRef(0),[d,y]=n.useState(null),[m,I]=n.useState(!1),{isEnabled:Ve}=Me(),[O,W]=n.useState(!0),Y=pe(),se=((de=Y.items)==null?void 0:de.filter(t=>t.kind==="driver_location_ping").length)||0,[be,ye]=n.useState(0),[ve,re]=n.useState(0),[_,B]=n.useState(null),[Ae,G]=n.useState(0),w=n.useRef(null),[V,je]=n.useState(null),[ae,Ne]=n.useState(()=>{try{const t=localStorage.getItem("offer_sound_on");return t===null?!0:t==="1"}catch{return!0}}),K=n.useRef(null),[we,Se]=n.useState(()=>{try{return localStorage.getItem("driver_tip_online_seen")!=="1"}catch{return!0}}),[Ke,Ze]=n.useState(null);async function ne(){var t;if(o)try{try{const r=await J.availability(o);y(r)}catch{}try{const r=await J.driverMe(o),c=!!(((t=r==null?void 0:r.driver)==null?void 0:t.isAvailable)??!0);W(c)}catch{}}catch{}}n.useEffect(()=>{if(!o)return;U()||xe(o);const t=U();if(!t)return;function r(s){const u=Te.safeParse({...s,createdAt:Date.now(),status:"offer_pending"});if(!u.success){a({message:"Ignored invalid offer payload",type:"error"});return}const f={...u.data,pickup:Array.isArray(s==null?void 0:s.pickup)?s.pickup:void 0,expiresAt:s==null?void 0:s.expiresAt,eta:(s==null?void 0:s.etaToPickup)??(u==null?void 0:u.eta)};A(x=>[f,...x.filter(k=>k.rideId!==f.rideId)].slice(0,50)),a({message:`Offer ${f.rideId}`,type:"info"}),b(f),ie(f.rideId).catch(()=>{});try{ae&&(K.current||Ie(),K.current.play().catch(()=>{}))}catch{}}function c(s){try{if((s==null?void 0:s.status)==="completed"){ye(f=>f+1),typeof s.finalFare=="number"?re(f=>f+s.finalFare):typeof s.fare=="number"&&re(f=>f+s.fare);const u=typeof s.finalFare=="number"?s.finalFare:typeof s.fare=="number"?s.fare:0;a({message:`Trip Complete • Earnings: ${E(u)}`,type:"success"})}}catch{}}return t.on("ride_request",r),t.on("ride_status",c),ne(),(async()=>{try{const s=await M("/surge/versions",{headers:{Authorization:`Bearer ${o}`}}),u=Array.isArray(s)?s:Array.isArray(s==null?void 0:s.items)?s.items:[],f=u.find(x=>x.active)||u[0];if(f&&f.grid){const x=f.grid.features||f.grid;Array.isArray(x)&&je(x)}}catch{}})(),()=>{t.off("ride_request",r),t.off("ride_status",c)}},[o,l.rideId]);async function ie(t){var r;if(o)try{let c=null;try{c=await M(`/rides/${t}/driver-view`,{headers:{Authorization:`Bearer ${o}`}})}catch{c=await M(`/rides/${t}`,{headers:{Authorization:`Bearer ${o}`}})}const s=(r=c==null?void 0:c.dropoff)==null?void 0:r.coordinates;if(Array.isArray(s)&&s.length===2){const u={dropoff:{lng:s[0],lat:s[1]}};S(u);try{const f=new URLSearchParams({lat:String(u.dropoff.lat),lng:String(u.dropoff.lng)}).toString(),x=await M(`/geocode/reverse?${f}`,{headers:{Authorization:`Bearer ${o}`}}),k=(x==null?void 0:x.displayName)||(x==null?void 0:x.display_name)||(x==null?void 0:x.name)||null;k&&S(L=>({...L||{},dropoffLabel:k}))}catch{}}}catch{}}async function ke(){if(!(!i||i.role!=="driver")){I(!0);try{const t=!O;try{if(await M("/drivers/availability",{method:"POST",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify({available:t})})){W(t),t?(B(Date.now()),w.current||(w.current=window.setInterval(()=>{G(c=>c)},1e3))):(G(c=>c+(_?Date.now()-_:0)),B(null),w.current&&(clearInterval(w.current),w.current=null)),ne(),a({message:`You are now ${t?"available":"unavailable"}`,type:"success"});return}}catch{}W(t),t?(B(Date.now()),w.current||(w.current=window.setInterval(()=>{G(r=>r)},1e3))):(G(r=>r+(_?Date.now()-_:0)),B(null),w.current&&(clearInterval(w.current),w.current=null)),y(r=>r&&{...r,available:Math.max(0,r.available+(t?1:-1)),busy:Math.max(0,r.busy+(t?-1:1))}),a({message:`(Simulated) now ${t?"available":"unavailable"}`,type:"info"})}finally{I(!1)}}}async function Z(t,r){r?await l.accept(t):await l.decline(t),A(c=>c.map(s=>s.rideId===t?{...s,status:r?"accepted":"declined"}:s))}async function Ce(){if(!o)return;const t=Ue(j.lat),r=Je(j.lng);if(t===null||r===null){a({message:"invalid_coords",type:"error"});return}R(!0);const c=await Y.sendDriverLocationOrQueue({lat:t,lng:r});c.mode==="immediate"&&!c.error&&a({message:"Location ping sent",type:"info"}),c.error&&a({message:c.error.friendlyMessage||c.error.error||"loc_failed",type:"error"}),R(!1)}function z(){var t;try{C.current!==null&&((t=navigator.geolocation)!=null&&t.clearWatch)&&navigator.geolocation.clearWatch(C.current)}catch{}C.current=null,F(!1)}async function le(){var r,c;if(!o){a({message:"login_required",type:"error"});return}if(!("geolocation"in navigator)){a({message:"Geolocation not supported on this device",type:"error"});return}try{const s=await(((c=(r=navigator.permissions)==null?void 0:r.query)==null?void 0:c.call(r,{name:"geolocation"}))||Promise.resolve(null));if(s&&s.state==="denied"){a({message:"Location permission denied",type:"error"});return}}catch{}const t=1500;try{const s=navigator.geolocation.watchPosition(async u=>{const f=Date.now();if(f-q.current<t)return;q.current=f;const{latitude:x,longitude:k,heading:L,speed:X,accuracy:ee}=u.coords||{};if(typeof x!="number"||typeof k!="number")return;const $={lat:x,lng:k};typeof L=="number"&&!Number.isNaN(L)&&($.heading=L),typeof X=="number"&&!Number.isNaN(X)&&($.speed=X),typeof ee=="number"&&!Number.isNaN(ee)&&($.accuracy=ee),$.timestamp=u.timestamp||Date.now();const te=await Y.sendDriverLocationOrQueue($);te.error&&a({message:te.error.friendlyMessage||te.error.error||"loc_failed",type:"error"})},u=>{a({message:(u==null?void 0:u.message)||"Location watch error",type:"error"}),z()},{enableHighAccuracy:!0,maximumAge:1e3,timeout:1e4});C.current=s??null,F(!0),a({message:"Live location started",type:"success"})}catch(s){a({message:(s==null?void 0:s.message)||"Unable to start live location",type:"error"}),z()}}n.useEffect(()=>{l.rideId&&!N&&le(),!l.rideId&&N&&z()},[l.rideId]);async function H(t){if(l.rideId)try{t==="arrive"?await l.arrive():t==="start"?await l.start():await l.complete()}catch{}}const oe=n.useMemo(()=>{const t=h.find(r=>r.rideId===l.rideId);return(t==null?void 0:t.fare)??null},[h,l.rideId]);if(!i)return e.jsx("p",{children:"Login as a driver to view offers."});if(i&&i.role!=="driver")return e.jsx("p",{children:"Access restricted: driver role required."});const ce=(_?Date.now()-_:0)+Ae,Oe=Math.floor(ce/36e5),_e=Math.floor(ce%36e5/6e4),Pe=e.jsx("span",{className:`inline-flex items-center text-xs px-2 py-1 rounded-full ${O?"bg-emerald-500/20 text-emerald-300 border border-emerald-400/30":"bg-slate-700 text-slate-200 border border-slate-600"}`,children:O?"Online":"Offline"});function Ie(){const t="data:audio/wav;base64,UklGRmQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAChAAAAAAAAPwAAAP///wAAAP///wAAAP///wAAAP8AAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8AAP8A",r=new Audio(t);r.volume=.4,K.current=r}function Le(){return!we||O?null:e.jsxs("div",{className:"absolute z-40 mt-14 right-4 bg-slate-800 text-slate-100 border border-slate-600 rounded-xl p-3 shadow-xl w-64",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Go Online"}),e.jsx("div",{className:"text-xs opacity-80 mt-1",children:"Tap here to go Online and start receiving trip requests. We’ll stream your location to match you with nearby riders."}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{className:"text-xs underline",onClick:()=>{Se(!1);try{localStorage.setItem("driver_tip_online_seen","1")}catch{}},children:"Got it"})})]})}return e.jsxs("div",{className:"p-4 grid gap-4 bg-slate-900 text-slate-100 min-h-[calc(100vh-4rem)]",children:[(i==null?void 0:i.role)==="driver"&&(i==null?void 0:i.kycStatus)!=="approved"&&e.jsxs("div",{className:"rounded-xl bg-amber-500/20 border border-amber-500 text-amber-100 p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Action required: Complete KYC to start earning"}),e.jsx("div",{className:"text-sm opacity-90",children:"Your account is inactive until KYC is approved."})]}),e.jsx(Ee,{to:"/driver/kyc",className:"ml-3 text-xs underline text-amber-100",children:"Open KYC"})]}),e.jsxs("header",{className:"relative flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Driver ",Pe]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ke,disabled:m||!!l.rideId,title:l.rideId?"Go Offline after current trip":"",className:`h-12 px-5 rounded-2xl font-bold min-w-[120px] ${O?"bg-emerald-500 hover:bg-emerald-600 text-slate-900":"bg-slate-700 hover:bg-slate-600 text-slate-100"} disabled:opacity-50 ${m?"animate-pulse":""}`,children:m?"Updating…":O?"Online":"Offline"}),e.jsx("button",{onClick:()=>N?z():le(),className:`h-12 px-5 rounded-xl font-semibold ${N?"bg-sky-500 hover:bg-sky-600":"bg-slate-700 hover:bg-slate-600"}`,children:N?"Stop live location":"Start live location"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-sm font-bold border border-slate-600",title:(i==null?void 0:i.name)||"",children:((i==null?void 0:i.name)||"D").slice(0,1).toUpperCase()})]}),e.jsx(Le,{})]}),e.jsx("section",{className:"rounded-xl overflow-hidden border border-slate-700",children:e.jsx("div",{style:{height:260},children:e.jsxs(qe,{center:[parseFloat(j.lat)||6.5244,parseFloat(j.lng)||3.3792],zoom:13,scrollWheelZoom:!1,style:{height:"100%",width:"100%"},children:[e.jsx(Be,{attribution:"© OpenStreetMap contributors",url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png"}),e.jsx(Ge,{position:[parseFloat(j.lat)||6.5244,parseFloat(j.lng)||3.3792],icon:ze.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconSize:[25,41],iconAnchor:[12,41],shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"}),children:e.jsx(We,{children:"Your location"})}),Array.isArray(V)&&V.length>0&&e.jsx(Qe,{data:{type:"FeatureCollection",features:V},style:t=>{var s,u;const r=((s=t==null?void 0:t.properties)==null?void 0:s.multiplier)??((u=t==null?void 0:t.properties)==null?void 0:u.surge)??1,c=r>=2?"#ef4444":r>=1.5?"#f59e0b":r>1?"#fde68a":"#374151";return{color:c,weight:1,fillColor:c,fillOpacity:r>1?.25:.08}}})]})})}),v&&e.jsxs("div",{className:"rounded-xl bg-red-600/20 border border-red-600 text-red-100 p-3 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"SOS received"}),e.jsx("div",{className:"text-sm opacity-90",children:v.rideId?`Ride ${v.rideId}`:"Active ride"}),typeof v.lat=="number"&&typeof v.lng=="number"&&e.jsxs("div",{className:"text-xs opacity-80",children:["Last known: ",v.lat.toFixed(5),", ",v.lng.toFixed(5)," ",e.jsx("a",{className:"underline ml-1",target:"_blank",rel:"noreferrer",href:`https://www.google.com/maps?q=${v.lat},${v.lng}`,children:"Open in Maps"})]})]}),e.jsx("button",{onClick:Q,className:"ml-3 text-xs underline",children:"Dismiss"})]}),d&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800",children:["Total: ",e.jsx("span",{className:"font-bold",children:d.total})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800",children:["Available: ",e.jsx("span",{className:"font-bold text-emerald-400",children:d.available})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800",children:["Busy: ",e.jsx("span",{className:"font-bold text-amber-400",children:d.busy})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"mb-2 font-medium",children:"Offers"}),e.jsx("ul",{className:"grid gap-3",children:h.map(t=>e.jsxs("li",{className:"rounded-xl bg-slate-800 p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-400",children:t.rideId}),e.jsxs("div",{className:"text-sm",children:["Fare: ",e.jsx("span",{className:"font-semibold",children:typeof t.fare=="number"?E(t.fare):"—"})," • ETA to pickup: ",t.eta??"—","m ",typeof t.surgeMultiplier=="number"&&e.jsxs("span",{className:"ml-1 text-amber-300",children:["surge x",t.surgeMultiplier]})]}),Array.isArray(t.pickup)&&t.pickup.length===2&&e.jsxs("div",{className:"text-[11px] text-slate-400",children:["Pickup: ",t.pickup[1].toFixed(5),", ",t.pickup[0].toFixed(5)," ",e.jsx("a",{className:"underline",target:"_blank",rel:"noreferrer",href:`https://www.google.com/maps?q=${t.pickup[1]},${t.pickup[0]}`,children:"Open in Maps"})]}),t.expiresAt&&e.jsxs("div",{className:"text-[11px] text-amber-300",children:["Expires in ",e.jsx(ue,{ts:t.expiresAt})]}),e.jsx("div",{className:"text-[11px] text-slate-400",children:t.status})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:!!l.rideId||l.accepting,onClick:()=>{b(t),ie(t.rideId).catch(()=>{})},className:"h-12 px-4 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-slate-900 font-bold disabled:opacity-50",children:"VIEW"}),e.jsx("button",{disabled:!!l.rideId||l.accepting,onClick:()=>Z(t.rideId,!1),className:"h-12 px-4 rounded-lg bg-red-500 hover:bg-red-600 text-white font-bold disabled:opacity-50",children:"DECLINE"})]})]},t.rideId))})]}),e.jsxs("section",{className:"sticky bottom-16 md:static grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800",children:["Trips Today: ",e.jsx("span",{className:"font-bold text-emerald-400",children:be})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800",children:["Earnings: ",e.jsx("span",{className:"font-bold",children:E(ve||0)})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-slate-800",children:["Online: ",e.jsxs("span",{className:"font-bold",children:[Oe,"h ",_e,"m"]})]})]}),l.rideId&&e.jsxs("section",{className:"grid gap-3 rounded-xl bg-slate-800 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium m-0",children:"Active Ride"}),oe!==null&&e.jsxs("div",{className:"text-sm",children:["Earnings: ",e.jsx("span",{className:"font-semibold",children:E(oe||0)})]})]}),se>0&&e.jsxs("div",{className:"text-xs text-amber-300",children:["Queued location pings: ",se]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>H("arrive"),disabled:["arrived_pickup","on_trip","completed"].includes(l.status||""),className:"h-12 px-5 rounded-lg bg-sky-500 hover:bg-sky-600 text-slate-900 font-bold disabled:opacity-40",children:"ARRIVE"}),e.jsx("button",{onClick:()=>H("start"),disabled:l.status!=="arrived_pickup"||["on_trip","completed"].includes(l.status||""),className:"h-12 px-5 rounded-lg bg-amber-400 hover:bg-amber-500 text-slate-900 font-bold disabled:opacity-40",children:"START"}),e.jsx("button",{onClick:()=>H("complete"),disabled:l.status!=="on_trip",className:"h-12 px-5 rounded-lg bg-emerald-400 hover:bg-emerald-500 text-slate-900 font-bold disabled:opacity-40",children:"COMPLETE"})]}),!N&&e.jsx("div",{className:"text-xs text-slate-300",children:'Tip: Enable "Start live location" above to stream your GPS to the rider in real-time.'}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"text-xs",children:["Lat",e.jsx("input",{className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-sm",value:j.lat,onChange:t=>T(r=>({...r,lat:t.target.value}))})]}),e.jsxs("label",{className:"text-xs",children:["Lng",e.jsx("input",{className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-sm",value:j.lng,onChange:t=>T(r=>({...r,lng:t.target.value}))})]})]}),e.jsx("button",{disabled:D,onClick:Ce,className:"h-12 rounded-lg bg-slate-700 hover:bg-slate-600 font-semibold",children:D?"Pinging…":"Send Location Ping"})]}),p&&e.jsx("div",{className:"fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-end md:items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 border border-slate-700 p-5 shadow-2xl animate-[slide-up_200ms_ease-out]",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Offer • ",p.rideId]}),e.jsx("div",{className:"mt-2 text-2xl font-extrabold text-white",children:typeof p.fare=="number"?E(p.fare):"—"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-300",children:["ETA to pickup: ",p.eta??"—"," mins"]}),Array.isArray(p.pickup)&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Pickup: ",p.pickup[1].toFixed(5),", ",p.pickup[0].toFixed(5)]}),(g==null?void 0:g.dropoff)&&e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Dropoff: ",g.dropoffLabel||`${g.dropoff.lat.toFixed(5)}, ${g.dropoff.lng.toFixed(5)}`]}),p.expiresAt&&e.jsxs("div",{className:"mt-3 text-sm text-amber-300",children:["Time left: ",e.jsx("span",{className:"text-lg font-bold",children:e.jsx(ue,{ts:p.expiresAt})})]}),e.jsxs("div",{className:"mt-4 grid gap-2",children:[e.jsx("button",{onClick:async()=>{await Z(p.rideId,!0),b(null)},className:"min-h-16 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-slate-900 text-lg font-extrabold transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-emerald-400 animate-pulse",disabled:!!l.rideId||l.accepting,children:"ACCEPT RIDE"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>b(null),className:"text-xs text-slate-400 underline mt-1",children:"Close"}),e.jsx("button",{onClick:async()=>{await Z(p.rideId,!1),b(null)},className:"h-10 px-4 rounded-xl border border-slate-600 text-slate-300 hover:bg-slate-800",disabled:!!l.rideId||l.accepting,children:"Decline"})]}),e.jsx("div",{className:"flex items-center justify-end gap-2 mt-1 text-xs text-slate-400",children:e.jsxs("label",{className:"inline-flex items-center gap-1 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:t=>{Ne(t.target.checked);try{localStorage.setItem("offer_sound_on",t.target.checked?"1":"0")}catch{}}}),"Sound on offer"]})})]})]})})]})}export{st as default};
