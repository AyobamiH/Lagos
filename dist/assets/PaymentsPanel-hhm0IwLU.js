import{u as m,r as i,j as a,c as s}from"./index-CQqwMk0w.js";const x=()=>{const{token:o}=m(),[d,p]=i.useState(""),[r,u]=i.useState(""),[c,y]=i.useState(""),[h,f]=i.useState([]);function n(t){f(e=>[t,...e].slice(0,50))}return o?a.jsxs("div",{style:{display:"grid",gap:12},children:[a.jsx("h2",{children:"Payments"}),a.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[a.jsx("input",{placeholder:"Ride ID",value:d,onChange:t=>p(t.target.value)}),a.jsx("button",{disabled:!d,onClick:async()=>{try{const t="init-"+crypto.randomUUID(),e=await s.paymentInitiate(o,{rideId:d,method:"card"},t);u(e.paymentId||e._id),n({action:"init",p:e,key:t})}catch(t){n({action:"err",e:(t==null?void 0:t.friendlyMessage)||(t==null?void 0:t.error)||"init_failed"})}},children:"Initiate"}),a.jsx("input",{placeholder:"Payment ID",value:r,onChange:t=>u(t.target.value)}),a.jsx("input",{placeholder:"Amount",value:c,onChange:t=>y(t.target.value),style:{width:90}}),a.jsx("button",{disabled:!r,onClick:async()=>{try{const t=await s.paymentGet(o,r);n({action:"get",r:t})}catch(t){n({action:"err",e:t})}},children:"Get"}),a.jsx("button",{disabled:!r,onClick:async()=>{try{const t=c?parseFloat(c):void 0,e="cap-"+crypto.randomUUID(),l=await s.paymentCapture(o,r,t,e);n({action:"capture",r:l,key:e})}catch(t){const e=(t==null?void 0:t.code)||(t==null?void 0:t.error);n(e==="concurrent_update"?{action:"err",e:"concurrent_update_retry"}:{action:"err",e:(t==null?void 0:t.friendlyMessage)||e||"capture_failed"})}},children:"Capture"}),a.jsx("button",{disabled:!r,onClick:async()=>{try{const t=c?parseFloat(c):void 0,e="ref-"+crypto.randomUUID(),l=await s.paymentRefund(o,r,t,e);n({action:"refund",r:l,key:e})}catch(t){const e=(t==null?void 0:t.code)||(t==null?void 0:t.error);n(e==="concurrent_update"?{action:"err",e:"concurrent_update_retry"}:{action:"err",e:(t==null?void 0:t.friendlyMessage)||e||"refund_failed"})}},children:"Refund"})]}),a.jsx("pre",{style:{maxHeight:240,overflow:"auto",background:"#111",color:"#0f0",padding:8,fontSize:11},children:h.map((t,e)=>`#${e} ${JSON.stringify(t)}
`).join("")})]}):a.jsx("p",{children:"Auth required"})};export{x as PaymentsPanel};
