import{u as q,j as e,L as g,r as l,c as h}from"./index-CQqwMk0w.js";function G(){const w=q();if(!w)return e.jsxs("p",{children:["Not logged in. ",e.jsx(g,{to:"/login",children:"Login"})]});const{profile:t,token:r,logout:P}=w,[n,S]=l.useState(""),u=4,[j,L]=l.useState(!1),[A,m]=l.useState(null),[p,c]=l.useState([]),[M,C]=l.useState(!1),[_,E]=l.useState(!1),[D,O]=l.useState(null),[F,R]=l.useState(null),[$,N]=l.useState(null),[x,f]=l.useState(""),v=2e3;if(l.useEffect(()=>{r&&(C(!0),h.listMyFeedback(r).then(s=>c(s.items||[])).catch(()=>{}).finally(()=>C(!1)))},[r,_]),!r)return e.jsxs("p",{children:["Not logged in. ",e.jsx(g,{to:"/login",children:"Login"})]});async function Y(s){s.preventDefault();const i=n.trim();if(!i)return;if(i.length<u){m(`feedback_too_short (min ${u})`);return}const d=performance.now();L(!0),m(null),E(!1),R(null);try{const a={id:`tmp-${Date.now()}`,createdAt:new Date().toISOString(),message:i,optimistic:!0};c(b=>[a,...b]);const o=await h.submitFeedback(r,i);c(b=>b.map(k=>k.id===a.id?{...k,...o,message:a.message,optimistic:!1}:k)),S(""),E(!0)}catch(a){a.status===429&&a.retryReset?O(a.retryReset):m(a.error||"submit_failed"),c(o=>o.filter(b=>!b.optimistic))}finally{L(!1)}R(Math.round(performance.now()-d))}function y(){if(!D)return 0;const s=D-Date.now();return s>0?Math.ceil(s/1e3):0}function K(s){N(s._id||s.id),f(s.message)}function I(){N(null),f("")}async function U(s){if(!x.trim())return;const i=p.find(d=>(d._id||d.id)===s);if(i)try{const d=await h.updateFeedback(r,s,x.trim(),i.createdAt);c(a=>a.map(o=>(o._id||o.id)===s?{...o,message:x.trim(),createdAt:d.createdAt}:o)),I()}catch(d){if(d.status===409)try{const a=await h.listMyFeedback(r);c(a.items||[]),N(s),f(x.trim()),m("edit_conflict_refresh")}catch{m("edit_conflict_refresh")}else m(d.error||"edit_failed")}}async function z(s){const i=p;c(d=>d.filter(a=>(a._id||a.id)!==s));try{await h.deleteFeedback(r,s)}catch{m("delete_failed"),c(i)}}return e.jsxs("div",{className:"grid gap-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Profile"}),e.jsx("button",{className:"px-4 h-10 rounded-lg bg-slate-800 text-slate-100 hover:bg-slate-700",onClick:async()=>{try{if(r)try{await h.logout(r)}catch{}}finally{P()}},children:"Logout"})]}),e.jsx("section",{className:"rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-4 grid gap-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Name"}),e.jsx("div",{className:"text-base font-medium",children:(t==null?void 0:t.name)||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Phone"}),e.jsx("div",{className:"text-base font-medium",children:(t==null?void 0:t.phone)||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Role"}),e.jsx("div",{className:"text-base font-medium capitalize",children:(t==null?void 0:t.role)||"—"})]})]})}),(t==null?void 0:t.role)==="driver"?e.jsxs("section",{className:"rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-4 grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Availability"}),e.jsx("div",{className:"text-base font-medium",children:t!=null&&t.isAvailable?"Online":"Offline"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Rating"}),e.jsx("div",{className:"text-base font-medium",children:typeof(t==null?void 0:t.rating)=="number"?t.rating.toFixed(1):"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Last Active"}),e.jsx("div",{className:"text-base font-medium",children:t!=null&&t.lastActiveAt?new Date(t.lastActiveAt).toLocaleString():"—"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500",children:"KYC"}),e.jsx("div",{className:`text-base font-medium ${(t==null?void 0:t.kycStatus)==="approved"?"text-emerald-600":"text-amber-600"}`,children:(t==null?void 0:t.kycStatus)||"—"})]}),e.jsxs("div",{className:"flex gap-2",children:[(t==null?void 0:t.kycStatus)!=="approved"&&e.jsx(g,{to:"/driver/kyc",className:"px-4 h-10 rounded-lg bg-amber-500 text-slate-900 font-semibold hover:bg-amber-600",children:"Complete KYC"}),e.jsx(g,{to:"/driver",className:"px-4 h-10 rounded-lg bg-sky-500 text-slate-900 font-semibold hover:bg-sky-600",children:"Open Driver Panel"})]})]})]}):e.jsx("section",{className:"rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-4 grid gap-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Payment Methods"}),e.jsx("div",{className:"text-base font-medium",children:Array.isArray(t==null?void 0:t.paymentMethods)&&t.paymentMethods.length?t.paymentMethods.join(", "):"Cash only"})]}),e.jsx(g,{to:"/profile#payments",className:"px-4 h-10 rounded-lg bg-emerald-500 text-slate-900 font-semibold hover:bg-emerald-600",children:"Add a card"})]})}),e.jsxs("section",{className:"rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-4",children:[e.jsx("h3",{className:"font-medium mt-0",children:"Send Feedback"}),e.jsxs("form",{onSubmit:Y,className:"grid gap-2",children:[e.jsx("textarea",{placeholder:"Share something that was confusing or needs improvement",value:n,onChange:s=>S(s.target.value),rows:4,className:"w-full rounded-md border border-slate-300 dark:border-slate-600 bg-transparent px-3 py-2",maxLength:2e3}),e.jsxs("small",{className:`${n.length>v*.9?"text-red-600":n.length>v*.75?"text-amber-600":"text-slate-500"}`,children:[n.length,"/",v]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{type:"submit",disabled:j||!n.trim()||n.trim().length<u||y()>0,className:"px-4 h-10 rounded-lg bg-slate-800 text-slate-100 disabled:opacity-50",children:"Submit"}),j&&e.jsx("span",{children:"Submitting..."}),_&&!j&&e.jsx("span",{className:"text-emerald-600",children:"Saved"}),F!==null&&!j&&e.jsxs("span",{className:"text-xs opacity-70",children:["lat ",F,"ms"]}),y()>0&&e.jsxs("span",{className:"text-red-600",children:["Cooldown ",y(),"s"]})]}),n.trim().length>0&&n.trim().length<u&&e.jsxs("p",{className:"text-red-600 text-xs",children:["Minimum ",u," characters"]}),A&&e.jsx("p",{className:"text-red-600",children:A})]})]}),e.jsxs("section",{className:"rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-4",children:[e.jsx("h3",{className:"font-medium mt-0",children:"Your Recent Feedback"}),M&&e.jsx("p",{children:"Loading..."}),!M&&!p.length&&e.jsx("p",{children:"No feedback yet."}),e.jsx("ul",{className:"grid gap-2 list-none p-0 m-0",children:p.map(s=>{const i=s._id||s.id,d=$===i;return e.jsxs("li",{className:"rounded-lg bg-slate-50 dark:bg-slate-800 p-3",children:[e.jsxs("div",{className:"text-xs opacity-70 flex gap-2 items-center",children:[e.jsx("span",{children:new Date(s.createdAt).toLocaleString()}),s.optimistic&&e.jsx("em",{className:"text-slate-500",children:"sending..."})]}),!d&&e.jsx("div",{className:"whitespace-pre-wrap",children:s.message}),d&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("textarea",{value:x,onChange:a=>f(a.target.value),rows:3,className:"w-full rounded-md border border-slate-300 dark:border-slate-600 bg-transparent px-3 py-2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>U(i),disabled:!x.trim(),className:"px-3 h-9 rounded bg-slate-800 text-slate-100 disabled:opacity-50",children:"Save"}),e.jsx("button",{onClick:I,className:"px-3 h-9 rounded border border-slate-300 dark:border-slate-600",children:"Cancel"})]})]}),!d&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>K(s),disabled:s.optimistic,className:"px-3 h-9 rounded border border-slate-300 dark:border-slate-600 disabled:opacity-50",children:"Edit"}),e.jsx("button",{onClick:()=>z(i),disabled:s.optimistic,className:"px-3 h-9 rounded bg-red-500 text-white disabled:opacity-50",children:"Delete"})]})]},i)})})]})]})}export{G as default};
