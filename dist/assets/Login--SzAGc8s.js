import{u as E,r as c,a as I,b as R,j as r}from"./index-CQqwMk0w.js";import{C as k,B as m,I as w}from"./Card-PAg5MTr5.js";function $(){const{login:j,driverLogin:N,error:d,errorDetails:P,loading:u,profile:t,token:o}=E(),[s,L]=c.useState(""),[n,S]=c.useState(""),[a,p]=c.useState("rider"),[l,h]=c.useState(!1),g=I(),_=R(),x=new URLSearchParams(_.search),C=x.get("next")||"/driver";c.useEffect(()=>{if(o&&t&&l){const e=(t==null?void 0:t.role)==="driver",i=x.get("next")||(e?"/driver":"/profile");g(i,{replace:!0})}},[o,t,l,g,C]);const f=s&&!/^\+?[0-9]{6,20}$/.test(s.replace(/[^0-9+]/g,""))?"Phone format":null,v=n&&n.length<8?"Min 8 chars":null,y=!!(u||!s||!n||f||v||l&&o&&t);function D(e){if(!e)return null;switch(e){case"invalid_phone_format":return"Phone number format is invalid.";case"min_length_8":return"Password must be at least 8 characters.";case"invalid_credentials":return"Incorrect phone or password.";case"login_failed":return"Login failed. Please try again.";case"rate_limited":return"Too many attempts. Please wait and retry.";default:return null}}const b=e=>(P||[]).filter(i=>i.field===e).map(i=>i.msg||i.message)[0];return r.jsx("div",{className:"auth-hero-container lagos-gradient-bg",children:r.jsxs(k,{title:`Login (${a})`,className:"card-elevated w-full max-w-md",children:[r.jsxs("div",{className:"flex gap-2 mb-4",children:[r.jsx(m,{type:"button",variant:a==="rider"?"primary":"secondary",disabled:a==="rider",onClick:()=>p("rider"),className:"text-xs px-3 py-1",children:"Rider"}),r.jsx(m,{type:"button",variant:a==="driver"?"primary":"secondary",disabled:a==="driver",onClick:()=>p("driver"),className:"text-xs px-3 py-1",children:"Driver"})]}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!y){h(!0);try{await(a==="driver"?N(s,n):j(s,n))}catch{h(!1)}}},className:"space-y-4",children:[r.jsx(w,{label:"Phone",placeholder:"+15551234567",value:s,onChange:e=>L(e.target.value),error:b("phone")||f}),r.jsx(w,{label:"Password",type:"password",placeholder:"••••••••",value:n,onChange:e=>S(e.target.value),error:b("password")||v}),r.jsx("div",{className:"pt-2",children:r.jsx(m,{type:"submit",loading:u,disabled:y,className:"w-full",children:u?"Logging in…":l&&o&&t?"Redirecting…":a==="driver"?"Driver Login":"Login"})})]}),d&&r.jsx("p",{className:"mt-4 text-sm text-red-600",children:D(d)||d}),!d&&l&&o&&!t&&r.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"Loading your profile…"})]})})}export{$ as default};
