const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MapPicker-DSPx7sIn.js","assets/index-CQqwMk0w.js","assets/index-zbX1gslc.css","assets/TileLayer-Bir63tuw.js","assets/leaflet-CEdCld2y.js","assets/leaflet-Dgihpmma.css"])))=>i.map(i=>d[i]);
import{u as E,r as s,d as T,j as e,c as D,_ as z}from"./index-CQqwMk0w.js";import{a as p,p as g}from"./validation-Bd_H_RqW.js";import{f as I}from"./format-CHNCD0FC.js";import{u as N}from"./useRideRequest-DyNG5dVe.js";const W=s.lazy(()=>z(()=>import("./MapPicker-DSPx7sIn.js"),__vite__mapDeps([0,1,2,3,4,5])).then(c=>({default:c.MapPicker}))),F=()=>{const{token:c}=E(),[h,f]=s.useState("form"),[a,x]=s.useState({lat:"6.5244",lng:"3.3792"}),[n,y]=s.useState({lat:"37.7849",lng:"-122.4094"}),[j,R]=s.useState("standard"),[m,P]=s.useState("cash"),[v,_]=s.useState(null),[k,L]=s.useState(null),[S,i]=s.useState(null),[d,o]=s.useState(!1),[M,q]=s.useState(!1);T();const r=N();async function Q(){if(!c){i("not_authenticated");return}const t=g(a.lat),l=p(a.lng),b=g(n.lat),C=p(n.lng);if([t,l,b,C].some(u=>u===null)){i("invalid_coordinates");return}o(!0),i(null);try{const u=await D.getQuote({pickup:{lat:t,lng:l},dropoff:{lat:b,lng:C},productType:j});_(u),f("quote")}catch(u){i(u.error||"quote_failed")}o(!1)}async function w(){if(c){o(!0),i(null),q(!1);try{if(!["cash","card"].includes(m)){i("invalid_payment_method"),o(!1);return}const l=await r.submit({pickupLat:a.lat,pickupLng:a.lng,dropLat:n.lat,dropLng:n.lng,productType:j,paymentMethod:m});l==="queued"&&(q(!0),L(null)),l==="immediate"&&r.ride&&L(r.ride),f("result")}catch(t){i(t.error||"request_failed")}o(!1)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("h2",{children:"Ride Wizard"}),S&&e.jsx("p",{style:{color:"red"},children:S}),h==="form"&&e.jsxs("div",{style:{display:"grid",gap:8,maxWidth:420},children:[e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("label",{style:{flex:1},children:["Pickup Lat",e.jsx("input",{value:a.lat,onChange:t=>x(l=>({...l,lat:t.target.value}))})]}),e.jsxs("label",{style:{flex:1},children:["Pickup Lng",e.jsx("input",{value:a.lng,onChange:t=>x(l=>({...l,lng:t.target.value}))})]})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("label",{style:{flex:1},children:["Drop Lat",e.jsx("input",{value:n.lat,onChange:t=>y(l=>({...l,lat:t.target.value}))})]}),e.jsxs("label",{style:{flex:1},children:["Drop Lng",e.jsx("input",{value:n.lng,onChange:t=>y(l=>({...l,lng:t.target.value}))})]})]}),e.jsxs("label",{children:["Product Type",e.jsxs("select",{value:j,onChange:t=>R(t.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"premium",children:"Premium"})]})]}),e.jsxs("label",{children:["Payment Method",e.jsxs("select",{value:m,onChange:t=>P(t.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{disabled:d,onClick:Q,children:d?"Loading...":"Get Quote"})]}),h==="quote"&&v&&e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsxs("p",{children:["Quote Total: ",I(v.total)," (surge ",v.surgeMultiplier||1,")"]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{disabled:d,onClick:()=>f("form"),children:"Back"}),e.jsx("button",{disabled:d,onClick:w,children:d?"Requesting...":"Request Ride"})]})]}),h==="result"&&e.jsxs("div",{style:{display:"grid",gap:8},children:[(M||r.queued)&&!k&&e.jsx("p",{style:{color:"#555"},children:"Ride request queued. It will be sent automatically when online & not rate-limited."}),(k||r.ride)&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Ride Created"}),e.jsx("pre",{children:JSON.stringify(k||r.ride,null,2)})]})]}),e.jsx(s.Suspense,{fallback:e.jsx("div",{style:{height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:"Loading map..."}),children:e.jsx(W,{pickup:{lat:g(a.lat)||0,lng:p(a.lng)||0},dropoff:{lat:g(n.lat)||0,lng:p(n.lng)||0},onChange:t=>{t.pickup&&x({lat:String(t.pickup.lat),lng:String(t.pickup.lng)}),t.dropoff&&y({lat:String(t.dropoff.lat),lng:String(t.dropoff.lng)})}})})]})};export{F as RideRequestWizard};
